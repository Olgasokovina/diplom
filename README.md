# Diplom

## Оглавление  
[1. Описание проекта](#описание-проекта)  
[2. Какой кейс решаем](#какаой-кейс-решаем)  
[3. Краткая информация о данных](#краткая-информация-о-данных)  
[4. Этапы работы над проектом](#этапы-работы-над-проектом)  
[5. Метод решения задачи](#метод-решения-задачи)  
[6. Результат](#резульат)  
[7. Как можно улучшить?](#Как-можно-улучшить-проект?)  

### Описание проекта  
Потроение рекомендательной системы для компании-ритейлера. Задача — повысить прибыль от допродаж в интернет-магазине.  


### Какаой кейс решаем  
Что практикуем:  
* Преобразование данных  
* Разведочный анализ  
* Очистка данных  
* Подбор модели машинного обучения, подбор гиперпараметров выбранной модели.  
* Реализации предложенного решения в продакшене.  
* Учимся писать хороший (красивый) код на Python, в соответствии с PEP8.  


### Краткая информация о данных  
В распоряжении будет база "сырых" данных.  
Набор данных состоит из трех файлов: файл с данными о поведении (events.csv), файл со свойствами элемента (item_properties.сsv) и файл, описывающий дерево категорий (category_tree.сsv). Данные были собраны с реального сайта электронной коммерции. Это сырые данные, т.е. без каких-либо преобразований контента, однако все значения хешированы из-за конфиденциальных вопросов.  
Данные о поведении, то есть такие события, как клики, добавление в корзину, транзакции, представляют собой взаимодействия, которые были собраны за период 4,5 месяца. Посетитель может совершать три типа событий, а именно «просмотр», «добавление в корзину» или «транзакция». Всего имеется 2 756 101 событие, включая 2 664 312 просмотров, 69 332 добавления в корзину и 22 457 транзакций, произведенных 1 407 580 уникальными посетителями. Для примерно 90% событий соответствующие свойства можно найти в файле «item_properties.csv».  
Файл свойств элемента содержит столбец метки времени, поскольку все они зависят от времени, поскольку свойства могут меняться со временем, например, цена, категория и т.д. Изначально этот файл состоял из снимков за каждую неделю в файле событий и содержал более 200 миллионов строк.  
Все значения в файле «item_properties.csv», за исключением свойств «categoryid» и «available», были хэшированы.  
Значение свойства «categoryid» содержит идентификатор категории элемента. 
Значение свойства «available» содержит доступность элемента, т. е. 1 означает, что элемент был доступен, в противном случае 0.  
Проблематика: В представленных данных очень много "шума" и это делает систему рекомендаций неэффективной.  


### Этапы работы над проектом   
* Внимательно изучить данные. Привести (перекодировать) данные в числовой вид (timestamp).  
* Провести очистку данных.  
* Провести разведочный анализ данных.  
* Выбрать наиболее подходящую модель машинного обучения. Провести подбор гиперпараметров. Поверить воспроизводимость модели - как модель работает на новых данных.  
* Реализовать решение в продакшене. Создать докер образ.  
* Загрузить ноутбук со своим решением на GitHub, оформив его в соответствии с требованиями.  


### Метод решения задачи  
Скачать данные, оценить какие данные имеются и в каком виде. Написать вспомогательные функции для извлечения необходимых данных. На основании этих данных создать новые признаки. Удалить ненужные, избыточные, мусорные данные. Попытаться с помощью мамематических методов и здравого смысла найти и удалить "выбросы". Заполнить, по возможности, недостающие данные. Визуализировать полученный результат. При этом код должен быть читаемым и понятным: имена переменных и функций отражать их сущность, избегать многострочных конструкций и условий.  
Создать новые признаки, улучшающие качество модели.  
Для валидации данные разбиваем в соотношении 70:15:15. Обучаем модель на тренировочной выборке подбираем гиперпараметры на волидационной выборке и проверяем метрики на тестовой выборке.  
При выборе рекомендательной мадели были использованы библиотеки surprise, implicit и lightfm и учитывалось качество рекомендаций, быстрота и размер конечной модели. Была выбрана библиотека implicit и модель LogisticMatrixFactorization.  
Для пользователей, которых модель уже "знает" - выдает рекомендации с учетом доступности этого товара в день рекомендации. Если модель "не занает" пользователя, то рекомендуются самые покупаемые товары за последний месяц. Если модель выдает меньше трех рекомендаций, добавляются топовые товары последнего месяца, так, чтобы рекомендаций было 3 штуки.  


### Резульат  
Ссылка на проект в GitHub с выполненными заданиями, выводами и графиками. Также прописан докерфайл и можно запускать предсказания из контейнера.  
Сделана презентация: https://docs.google.com/presentation/d/16agA14XDWHBzrUCXUk4gQl0kmDp8Labcb7D-p6LINfg/edit?usp=sharing  
docker build -t diplom_image . # создать контейнер  
docker run -it --rm -v <путь для сохранения файлов с рекомендациями>:/my_volume  --name server_container -p=5000:5000 diplom_image # Запустить контейнер  

Или можно стянуть докер-образ с dockerhub  
docker pull olgasokovina/diplom_image  
docker run -it --rm -v <путь для сохранения файлов с рекомендациями>:/my_volume  --name server_container -p=5000:5000 olgasokovina/diplom_image

app\test_.ipynb  # ноутбук для получения рекомендаций.  
Необходимо запустить контейнер, ввести необходимые данные и далее отправить пост запрос. Сервер может принимать запросы в виде списка, словаря и датафрейма. Если отправляют датафрейм, то рекоммендации будут даны только для первой (нулевой) строки. В словаре и датафрейме должны быть колонки (ключи) 'date', 'visitorid'. Если отправляют список, то сперва идет дата, а затем номер пользователя.  
Так как учитывается доступность товара на определенную дату, то нельзя вводить непонятно какую дату. Даты должны быть между 2015-05-03 и 2015-09-18. В реальных условиях (а не учебных) должны подтягиваться данные о доступности товара в реальном времени и дату не надо вводить (должна быть использована текущая дата и время)   

### Как можно улучшить проект?  
Безусловно можно сделать более "жесткую" очистку данных, но тогда может оказаться крайне мало данных для обучения.  
У нас практически нет данных о пользователях, кроме их "активности" (просмотры, добавление товарорв в корзину, покупки). Можно попытаться узнать предпочтения пользователей, проведя опрос. Полезным будет получать оценки от пользователей по поводу полученных рекомендаций, чтобы улучшить рекомендательную систему.  
Можно разбить пользователей на группы (допустим по предпочтениям) и для каждой группы обучить свою рекомендательную модель.  
Использовать метаданные, такие как категории, теги, и описания товаров, могут существенно улучшить рекомендации. Используйте их для улучшения контентного фильтра и добавления дополнительного контекста.  
Анализировать сезонные изменения и тренды в данных, чтобы учитывать их в процессе рекомендаций. Это может быть полезно для предсказания временных всплесков интереса к определенным товарам или услугам.  
Иногда пользователи хотят видеть новинки. Создайте фильтр, который рекомендует недавно добавленные товары, чтобы постоянно держать пользователей в курсе новых предложений.  
Постоянно проводить А/Б тесты, чтобы оценивать и сравнивать производительность разных рекомендательных моделей. Это поможет выбрать наиболее эффективные алгоритмы и подходы.  
Регулярно тестировать систему и анализировать результаты, чтобы находить и устранять слабые места.  
